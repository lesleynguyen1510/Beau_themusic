---
title: "Computational Musicology 2025 Portfolio"
output: 
  flexdashboard::flex_dashboard:
    orientation: columns
    vertical_layout: fill
    storyboard: true
    theme: paper
---

```{r setup, include=FALSE}
library(flexdashboard)
library(tidyverse)
library(ggplot2)
library(plotly)
source("compmus.R")
library(patchwork)

compmus2025 <- read.csv("compmus2025.csv", header = TRUE, sep = ",")

compmus2025 %>%
  summarise(
    mean_approachability = mean(approachability),
    mean_arousal = mean(arousal), 
    mean_danceability = mean(danceability), 
    mean_engagingness = mean(engagingness),
    mean_instrumentalness = mean(instrumentalness),
    mean_tempo = mean(tempo),
    mean_valence = mean(valence)
  )
```

### Chordograms

```{r, chordogram, fig.width=10, fig.height=6, out.width='80%'}
#      C     C#    D     Eb    E     F     F#    G     Ab    A     Bb    B
major_chord <-
  c(   1,    0,    0,    0,    1,    0,    0,    1,    0,    0,    0,    0)
minor_chord <-
  c(   1,    0,    0,    1,    0,    0,    0,    1,    0,    0,    0,    0)
seventh_chord <-
  c(   1,    0,    0,    0,    1,    0,    0,    1,    0,    0,    1,    0)

major_key <-
  c(6.35, 2.23, 3.48, 2.33, 4.38, 4.09, 2.52, 5.19, 2.39, 3.66, 2.29, 2.88)
minor_key <-
  c(6.33, 2.68, 3.52, 5.38, 2.60, 3.53, 2.54, 4.75, 3.98, 2.69, 3.34, 3.17)

chord_templates <-
  tribble(
    ~name, ~template,
    "Gb:7", circshift(seventh_chord, 6),
    "Gb:maj", circshift(major_chord, 6),
    "Bb:min", circshift(minor_chord, 10),
    "Db:maj", circshift(major_chord, 1),
    "F:min", circshift(minor_chord, 5),
    "Ab:7", circshift(seventh_chord, 8),
    "Ab:maj", circshift(major_chord, 8),
    "C:min", circshift(minor_chord, 0),
    "Eb:7", circshift(seventh_chord, 3),
    "Eb:maj", circshift(major_chord, 3),
    "G:min", circshift(minor_chord, 7),
    "Bb:7", circshift(seventh_chord, 10),
    "Bb:maj", circshift(major_chord, 10),
    "D:min", circshift(minor_chord, 2),
    "F:7", circshift(seventh_chord, 5),
    "F:maj", circshift(major_chord, 5),
    "A:min", circshift(minor_chord, 9),
    "C:7", circshift(seventh_chord, 0),
    "C:maj", circshift(major_chord, 0),
    "E:min", circshift(minor_chord, 4),
    "G:7", circshift(seventh_chord, 7),
    "G:maj", circshift(major_chord, 7),
    "B:min", circshift(minor_chord, 11),
    "D:7", circshift(seventh_chord, 2),
    "D:maj", circshift(major_chord, 2),
    "F#:min", circshift(minor_chord, 6),
    "A:7", circshift(seventh_chord, 9),
    "A:maj", circshift(major_chord, 9),
    "C#:min", circshift(minor_chord, 1),
    "E:7", circshift(seventh_chord, 4),
    "E:maj", circshift(major_chord, 4),
    "G#:min", circshift(minor_chord, 8),
    "B:7", circshift(seventh_chord, 11),
    "B:maj", circshift(major_chord, 11),
    "D#:min", circshift(minor_chord, 3)
  )

"features/lesley-n-1.json" |> 
 compmus_chroma(norm = "chebyshev") |> 
  compmus_match_pitch_templates(
    chord_templates,        
    norm = "chebyshev" 
  ) |>
  ggplot(aes(x = time, y = name, fill = d)) + 
  geom_raster() +
  scale_fill_viridis_c(option = "plasma") + 
  labs(title = "Track 1", 
       x = "Time (s)", 
       y = "Chords", 
       fill = NULL) +
  theme_light() +
 theme(axis.text.y = element_text(size = 8, hjust = 1),  
    axis.text.x = element_text(size = 8),
    plot.margin = margin(10, 10, 10, 10) 
 )



"features/lesley-n-2.json" |> 
  compmus_chroma(norm = "chebyshev") |> 
  compmus_match_pitch_templates(
    chord_templates,        
    norm = "chebyshev"
  ) |>
  ggplot(aes(x = time, y = name, fill = d)) + 
  geom_raster() +
  scale_fill_viridis_c(option = "plasma") + 
  labs(title = "Track 2", 
       x = "Time (s)", 
       y = "Chords", 
       fill = NULL) +
  theme_light() +
  theme(axis.text.y = element_text(size = 8, hjust = 1),  
    axis.text.x = element_text(size = 8),
    plot.margin = margin(10, 10, 10, 10)
  )
```  

***
These chordograms visualize the harmonic structure of Track 1 and 2, displaying the evolution of chords over time. The Y-axis represents different chords used in the track, including major (maj), minor (min), dominant 7th (7), and diminished chords, while the X-axis represents time in seconds. The color intensity indicates the activation strength or presence probability of each chord at any given moment, with <span style="color:gold"><b>bright yellow</b></span> signifying strong chord presence and <span style="color:purple"><b>dark purple</b></span> indicating weaker or less frequent occurrences

**Track 1**

- The chordogram shows a relatively stable harmonic structure throughout the piece, with minimal drastic changes

- The pitch material appears to be concentrated in specific regions, particularly around G♭ major, A♭ major, B major, and D♯ minor

- The intensity distribution is fairly even, suggesting recurrent harmonic patterns rather than abrupt modulations.
This track lacks significant harmonic shifts, indicating a more consistent chord progression and possibly a repetitive structure

**Track 2**

- Unlike Track 1, this track displays more frequent variations in harmonic intensity, which suggests a more dynamic harmonic progression

- There are clear moments of discontinuity around 60s, 100s, 160s, and 190s, indicating modulations or transitions between different sections of the piece

- The intensity variations across time suggest moments of greater harmonic complexity, potentially due to instrumental improvisation


### Keygrams
``` {r, keygram, fig.width=10, fig.height=6, out.width='80%'}
#      C     C#    D     Eb    E     F     F#    G     Ab    A     Bb    B
major_chord <-
  c(   1,    0,    0,    0,    1,    0,    0,    1,    0,    0,    0,    0)
minor_chord <-
  c(   1,    0,    0,    1,    0,    0,    0,    1,    0,    0,    0,    0)
seventh_chord <-
  c(   1,    0,    0,    0,    1,    0,    0,    1,    0,    0,    1,    0)

major_key <-
  c(6.35, 2.23, 3.48, 2.33, 4.38, 4.09, 2.52, 5.19, 2.39, 3.66, 2.29, 2.88)
minor_key <-
  c(6.33, 2.68, 3.52, 5.38, 2.60, 3.53, 2.54, 4.75, 3.98, 2.69, 3.34, 3.17)

key_templates <-
  tribble(
    ~name, ~template,
    "Gb:maj", circshift(major_key, 6),
    "Bb:min", circshift(minor_key, 10),
    "Db:maj", circshift(major_key, 1),
    "F:min", circshift(minor_key, 5),
    "Ab:maj", circshift(major_key, 8),
    "C:min", circshift(minor_key, 0),
    "Eb:maj", circshift(major_key, 3),
    "G:min", circshift(minor_key, 7),
    "Bb:maj", circshift(major_key, 10),
    "D:min", circshift(minor_key, 2),
    "F:maj", circshift(major_key, 5),
    "A:min", circshift(minor_key, 9),
    "C:maj", circshift(major_key, 0),
    "E:min", circshift(minor_key, 4),
    "G:maj", circshift(major_key, 7),
    "B:min", circshift(minor_key, 11),
    "D:maj", circshift(major_key, 2),
    "F#:min", circshift(minor_key, 6),
    "A:maj", circshift(major_key, 9),
    "C#:min", circshift(minor_key, 1),
    "E:maj", circshift(major_key, 4),
    "G#:min", circshift(minor_key, 8),
    "B:maj", circshift(major_key, 11),
    "D#:min", circshift(minor_key, 3)
  )
  
"features/lesley-n-1.json" |> 
 compmus_chroma(norm = "chebyshev") |> 
  compmus_match_pitch_templates(
    key_templates,        
    norm = "chebyshev" 
  ) |>
  ggplot(aes(x = time, y = name, fill = d)) + 
  geom_raster() +
  scale_fill_viridis_c(option = "plasma") + 
  labs(title = "Track 1", 
       x = "Time (s)", 
       y = "Keys", 
       fill = NULL) +
  theme_light() +
 theme(axis.text.y = element_text(size = 8, hjust = 1),  
    axis.text.x = element_text(size = 8),
    plot.margin = margin(10, 10, 10, 10) 
 )


"features/lesley-n-2.json" |> 
  compmus_chroma(norm = "chebyshev") |> 
  compmus_match_pitch_templates(
    key_templates,        
    norm = "chebyshev"
  ) |>
  ggplot(aes(x = time, y = name, fill = d)) + 
  geom_raster() +
  scale_fill_viridis_c(option = "plasma") + 
  labs(title = "Track 2", 
       x = "Time (s)", 
       y = "Keys", 
       fill = NULL) +
  theme_light() +
  theme(axis.text.y = element_text(size = 8, hjust = 1),  
    axis.text.x = element_text(size = 8),
    plot.margin = margin(10, 10, 10, 10)
  )
```

***
These keygrams exhibit a more ambiguous structure, with a diverse and less clearly defined focus on specific musical keys throughout the track. 

(I plan to analyze this further in the future, as I find some aspects of it quite confusing at the moment :) )

### Chromagram
``` {r}
"features/lesley-n-1.json" |>
  compmus_chroma(norm = "chebyshev") |>             
  ggplot(aes(x = time, y = pc, fill = value)) + 
  geom_raster() +
  scale_y_continuous(
    breaks = 0:11,
    minor_breaks = NULL,
    labels = c(
                "C", "C#|Db", "D", "D#|Eb",
                "E", "F", "F#|Gb", "G",
                "G#|Ab", "A", "A#|Bb", "B"
              )
  ) +
  scale_fill_viridis_c(guide = "none") +
  labs(title = "Track 1", 
       x = "Time (s)", 
       y = NULL, 
       fill = NULL) +
   theme_light() 

"features/lesley-n-2.json" |>
  compmus_chroma(norm = "chebyshev") |>             
  ggplot(aes(x = time, y = pc, fill = value)) + 
  geom_raster() +
  scale_y_continuous(
    breaks = 0:11,
    minor_breaks = NULL,
    labels = c(
                "C", "C#|Db", "D", "D#|Eb",
                "E", "F", "F#|Gb", "G",
                "G#|Ab", "A", "A#|Bb", "B"
              )
  ) +
  scale_fill_viridis_c(guide = "none") +
  labs(title = "Track 2", 
       x = "Time (s)", 
       y = NULL, 
       fill = NULL) +
   theme_light() 

```

***
The first chromagram reveals a dynamically structured piece that doesn’t settle on a single tonal center but rather employs a wide array of pitch classes throughout its duration

- **Broad Pitch Utilization**: The entire 12-tone pitch spectrum is active throughout the piece. Bright bands appear across nearly all pitch classes, indicating that the composition does not fixate on one key but instead incorporates chromatic elements or frequent modulations

- **Recurring Clusters**: Noticeable clusters of intense activity at specific time intervals suggest repeated melodic or harmonic motifs, hinting at the use of recurring chord progressions or thematic material


### Chroma-based and Timbre-based Self-similarity Matrices
``` {r}
p_chroma <- "features/lesley-n-1.json" |>                           
  compmus_chroma(norm = "chebyshev") |>                   
  compmus_self_similarity(
    feature = pc) |>   
  ggplot(aes(x = xtime, y = ytime, fill = d)) + 
  geom_raster() +
  scale_fill_viridis_c(guide = "none") +             
  labs(title = "Chroma",
       x = "Time (s)", y = NULL, fill = NULL) +
  theme_minimal(base_size = 14) +
  coord_fixed()

p_timbre <- "features/lesley-n-1.json" |>             
  compmus_mfccs(norm = "euclidean") |>  
  compmus_self_similarity(
    feature = mfcc,
    distance = "cosine"
  ) |>   
  ggplot(aes(x = xtime, y = ytime, fill = d)) + 
  geom_raster() +
  scale_fill_viridis_c(guide = "none") +
  labs( title = "Timbre", 
        x = "Time (s)", y = NULL, fill = NULL) +
  theme_minimal(base_size = 14) +
  coord_fixed()

 p_chroma + p_timbre
```

*** 
**Chroma-based Self-Similarity Matrix**

The block-like structures and distinct lines are more apparent, indicating sections of the track where harmonic repetition homogeneity occurs:

- Block-like structures: These represent homogeneous musical sections such as verses or choruses

- Distinct, sometimes blurred, paths parallel to the main diagonal: These indicate repeated sections occurring at regular time intervals, even if the patterns aren’t perfectly sharp

**Timbre-based Self-Similarity Matrix**

The block-like structures are less clear. Instead, the streaks are more blurred and evenly distributed, suggesting that there is variability in timbre throughout the track

- The absence of distinct parallel diagonal lines may indicate that the track experiences significant changes in instrumentation or arrangement between different sections

- Bright areas appearing along the edges and center might represent sections where there are changes in instrumentation or performance style, such as a drop or a solo instrumental segment

### Music in Advertising Videos and The Study about Vietnamese music

[A study by two researchers from Hungary](https://www.emerald.com/insight/content/doi/10.1108/cbth-11-2021-0265/full/html), Monica Coronel and Anna Irimiás, confirms that music plays an essential supporting role in “destination promotional videos” and “tourism marketing,” stimulating both cognitive and affective responses. Specifically, their research reveals that background music can capture attention, reflect a destination’s characteristics, target specific audiences, highlight cultural identity, elicit emotions, and create ambience.

These findings about the importance of music in tourism marketing led me to explore Vietnamese advertising music and compare it with global music trends. In particular, my research question focuses on:

**“How does the musical style of Vietnamese advertising music compare to other music? Does it have distinct characteristics, or does it align with broader global trends?”**

To represent Vietnamese advertising music, I selected two tracks suitable for advertising videos showcasing Vietnamese culture and nature. After experimenting with generative AI tools, I opted for royalty-free tracks from Pixabay and SoundCloud. I used keywords such as *“Vietnam,” “folk instruments,” “adventurous music,”* and *“travel”* on both platforms, and filtered for *“bright”* mood and *“cinematic music”* theme on Pixabay. I chose these tracks because they feature Vietnamese folk instruments—a key focus—and include a strong bass that enhances engagement and evokes emotions in listeners, aligning well with the commercial and storytelling purposes of advertising videos.


### Overview of Class Corpus and Lesley's Track

```{r}
compmus2025_numeric_original <- compmus2025 %>% select(where(is.numeric))

compmus2025_numeric_scaled <- as.data.frame(scale(compmus2025_numeric_original))

compmus2025_final <- cbind(compmus2025["filename"], compmus2025_numeric_scaled)

compmus2025_long <- pivot_longer(
  compmus2025_final, 
  cols = -filename, 
  names_to = "Feature", 
  values_to = "Value"
  )

compmus2025_original_long <- pivot_longer(
  cbind(compmus2025["filename"], compmus2025_numeric_original), 
  cols = -filename, names_to = "Feature", values_to = "RealValue"
  )

compmus2025_long <- left_join(
  compmus2025_long, 
  compmus2025_original_long, 
  by = c("filename", "Feature")
  )

compmus2025_long <- compmus2025_long %>%
  mutate(is_lesley = ifelse(grepl("lesley", filename, ignore.case = TRUE), "Lesley", "Other"))

# Plot
p <- ggplot(compmus2025_long, aes(x = Feature, y = Value)) +
  geom_boxplot(fill = "skyblue", color = "darkblue", outlier.shape = NA) + 
  geom_jitter(data = compmus2025_long %>% filter(is_lesley == "Other"), 
              aes(x = Feature, y = Value, text = paste(
                "Filename:", filename, 
                "<br>Feature:", Feature, 
                "<br>Real Value:", round(RealValue, 3)
              )),
              color = "black", width = 0.2, alpha = 0.4, size = 1.5) +  
  geom_jitter(data = compmus2025_long %>% filter(is_lesley == "Lesley"), 
              aes(x = Feature, y = Value, text = paste(
                "LESLEY",
                "<br>Filename:", filename, 
                "<br>Feature:", Feature, 
                "<br>Real Value:", round(RealValue, 3)
              )),
              color = "deeppink", width = 0.2, alpha = 10, size = 4) +  
   theme_light() +
  labs(x = "Essentia Features",
       y = "Normalized Value") +
  theme(axis.text.x = element_text(angle = 45, hjust = 1))
plotly_plot <- ggplotly(p, tooltip = "text")
plotly_plot <- style(plotly_plot, hoverinfo = "skip", traces = 1)
plotly_plot
```

***
This interactive boxplot presents the distribution of various Essentia features extracted from the class corpus. The <span style="color:black"><b>black</b></span> points represent all tracks in the dataset, while my tracks are highlighted in <span style="color:deeppink"><b>pink</b></span> for better visibility.

My tracks are scattered across different features, showing varying degrees of similarity and uniqueness compared to the "average" track in the corpus:

- **Arousal, Danceability, Engagingness and Valence**: My tracks tend to be closer to the median or remain within the general range of the corpus, suggesting they align with the typical characteristics of the class corpus

- **Approachability & Instrumentalness**: My two tracks are both positioned higher than the median, or  toward the higher end of the distribution, indicating they are significantly different from the majority of tracks

- **Tempo**: My tracks are distributed outside the interquartile range (IQR) with the intension to lean toward either the upper or lower quartile, showing that they deviate significantly from the majority of the class corpus with the higher-than-average or lower-than-average speeds


### Key Takeaways
Based on the distribution of my tracks compared to the class corpus, the key insights are:

- My tracks are not drastically different in features like *danceability* and *arousal*, meaning they share common rhythmic and energetic characteristics with the class corpus

- While my tracks generally follow the overall trends in most features, their placement in *instrumentalness* and *approachability* suggests a distinct musical approach, likely incorporating many traditional instruments with simpler harmonies and familiar structures to enhance accessibility for a diverse audience

- *Tempo* also show the uniqueness with a track leaning towards fast-paced compositions, while other adopt a slower, more relaxed pacing

This visualization provides a clear comparison of how my tracks align with the broader dataset and which features distinguish them. It confirms that Essentia effectively identifies track characteristics and highlights both similarities and unique elements of my track.

